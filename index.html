<script>
const encodedGraph = `PASTE YOUR BASE64 STRING HERE`;

const graph = JSON.parse(atob(encodedGraph));

// ðŸ”¥ FIX: Inject CSS classes automatically
graph.nodes = graph.nodes.map(n => {
  if (n.data && n.data.type) {
    if (n.data.type === "Layer" || n.data.type === "Subdomain") {
      n.classes = "ontology";
    }
    if (n.data.category === "External") {
      n.classes = "datasource";
    }
  }
  return n;
});

cytoscape.use(cytoscapeDagre);

// Init graph
const cy = cytoscape({
  container: document.getElementById('cy'),
  elements: graph,
  layout: { name:'dagre', rankDir:'TB' },
  style: [
    {
      selector:'node.ontology',
      style:{
        'background-color':'#2c6cf4',
        'label':'data(label)',
        'color':'white',
        'text-outline-color':'#0b1b2b',
        'text-outline-width':3,
        'font-size':10,
        'width':40,
        'height':40
      }
    },
    {
      selector:'node.datasource',
      style:{
        'background-color':'#00a88b',
        'label':'data(label)',
        'shape':'round-rectangle',
        'font-size':9,
        'color':'#012d26'
      }
    },
    {
      selector:'edge',
      style:{
        'line-color':'#aaa',
        'target-arrow-color':'#aaa',
        'target-arrow-shape':'triangle',
        'label':'data(label)',
        'font-size':9
      }
    }
  ]
});

// Buttons
document.getElementById('fitBtn').onclick = () => cy.fit();
document.getElementById('pngBtn').onclick = () => {
  const png = cy.png({full:true,scale:2});
  const a = document.createElement('a');
  a.href = png; a.download = "ontology.png"; a.click();
};
</script>
